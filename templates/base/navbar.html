{% load static %}
<!-- ==================== FIXED NAVBAR ==================== -->
<nav class="navbar navbar-expand-lg fixed-top navbar-light bg-white shadow-sm" id="mainNavbar">
  <div class="container position-relative">
    <!-- Brand Logo -->
    <a class="navbar-brand" href="{% url 'homepage' %}">
      <div class="brand-container d-flex align-items-center">
        <div class="logo-wrapper me-3">
          <img src="{% static 'assets/img/01_manufacturing_logo.png' %}" 
               alt="Everest Memorial Carpet Industry"
               class="brand-logo"
               onerror="this.style.display='none'">
          <div class="logo-glow"></div>
        </div>
        <div class="brand-text d-flex flex-column">
          <span class="brand-name fw-bold text-primary-navy">EVEREST MEMORIAL</span>
          <small class="brand-subtitle text-muted">CARPET INDUSTRY</small>
        </div>
      </div>
    </a>

    <!-- Mobile Toggle Button -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" 
            data-bs-target="#navbarContent" aria-controls="navbarContent" 
            aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Navbar Content -->
    <div class="collapse navbar-collapse" id="navbarContent">
      <!-- Navigation Menu -->
      <ul class="navbar-nav mx-auto mb-2 mb-lg-0 position-relative">
        <!-- Home -->
        <li class="nav-item mx-1">
          <a class="nav-link position-relative px-3 {% if request.path == '/' %}active{% endif %}" 
             href="{% url 'homepage' %}">
            <i class="bi bi-house-door me-1"></i>
            <span>Home</span>
            <div class="nav-underline"></div>
          </a>
        </li>

        <!-- About - Fixed Dropdown -->
        <li class="nav-item dropdown mx-1">
          <a class="nav-link dropdown-toggle position-relative px-3" href="#" 
             id="aboutDropdown" role="button" data-bs-toggle="dropdown" 
             aria-expanded="false">
            <i class="bi bi-info-circle me-1"></i>
            <span>About</span>
            <div class="nav-underline"></div>
          </a>
          <ul class="dropdown-menu dropdown-menu-start shadow border-0" 
              aria-labelledby="aboutDropdown" style="min-width: 280px;">
            <li>
              <a class="dropdown-item py-3" href="{% url 'about_us' %}">
                <div class="d-flex align-items-center">
                  <div class="dropdown-icon me-3">
                    <i class="bi bi-building text-primary-navy"></i>
                  </div>
                  <div>
                    <div class="fw-bold">About Us</div>
                    <small class="text-muted">Company profile & expertise</small>
                  </div>
                </div>
              </a>
            </li>
            <li><hr class="dropdown-divider my-2"></li>
            <li>
              <a class="dropdown-item py-3" href="{% url 'history' %}">
                <div class="d-flex align-items-center">
                  <div class="dropdown-icon me-3">
                    <i class="bi bi-clock-history text-primary-navy"></i>
                  </div>
                  <div>
                    <div class="fw-bold">History</div>
                    <small class="text-muted">Our journey since 1970s</small>
                  </div>
                </div>
              </a>
            </li>
            <li>
              <a class="dropdown-item py-3" href="{% url 'manufacturing' %}">
                <div class="d-flex align-items-center">
                  <div class="dropdown-icon me-3">
                    <i class="bi bi-gear text-primary-navy"></i>
                  </div>
                  <div>
                    <div class="fw-bold">Manufacturing Process</div>
                    <small class="text-muted">9-step Tibetan technique</small>
                  </div>
                </div>
              </a>
            </li>
          </ul>
        </li>

      <!-- Products - Quality Dropdown -->
<li class="nav-item dropdown mx-1">
  <a class="nav-link dropdown-toggle position-relative px-3" href="#" 
     id="productsDropdown" role="button" data-bs-toggle="dropdown" 
     aria-expanded="false">
    <i class="bi bi-grid-3x3-gap me-1"></i>
    <span>Products</span>
    <div class="nav-underline"></div>
  </a>
  <ul class="dropdown-menu dropdown-menu-start shadow border-0" 
      aria-labelledby="productsDropdown" style="min-width: 320px;">
    <li>
      <a class="dropdown-item py-3" href="{% url 'products' %}">
        <div class="d-flex align-items-center position-relative">
          <div class="quality-badge quality-all me-3">ALL</div>
          <div class="flex-grow-1">
            <div class="fw-bold">All Collections</div>
            <small class="text-muted">Browse complete catalog</small>
          </div>
        </div>
      </a>
    </li>
    <li><hr class="dropdown-divider my-2"></li>
    <li>
      <a class="dropdown-item py-3" href="{% url 'products' %}?quality=60">
        <div class="d-flex align-items-center position-relative">
          <div class="quality-badge quality-60 me-3">60</div>
          <div class="flex-grow-1">
            <div class="fw-bold">60 Knots Collection</div>
            <small class="text-muted">45 days delivery â€¢ Classic</small>
          </div>
          <span class="badge bg-success ms-2">Popular</span>
        </div>
      </a>
    </li>
    <li>
      <a class="dropdown-item py-3 premium-access" href="#" data-collection="80" data-bs-toggle="modal" data-bs-target="#loginModal">
        <div class="d-flex align-items-center position-relative">
          <div class="quality-badge quality-80 me-3">80</div>
          <div class="flex-grow-1">
            <div class="fw-bold">80 Knots Collection</div>
            <small class="text-muted">60 days delivery â€¢ Premium</small>
          </div>
          <span class="badge bg-primary ms-2">Premium Access</span>
        </div>
      </a>
    </li>
    <li>
      <a class="dropdown-item py-3 premium-access" href="#" data-collection="100" data-bs-toggle="modal" data-bs-target="#loginModal">
        <div class="d-flex align-items-center position-relative">
          <div class="quality-badge quality-100 me-3">100</div>
          <div class="flex-grow-1">
            <div class="fw-bold">100 Knots Collection</div>
            <small class="text-muted">90 days delivery â€¢ Exclusive</small>
          </div>
          <span class="badge bg-purple ms-2">VIP Access</span>
        </div>
      </a>
    </li>
  </ul>
</li>

        <!-- Gallery -->
        <li class="nav-item mx-1">
          <a class="nav-link position-relative px-3 {% if '/product_detail/' in request.path %}active{% endif %}" 
             href="{% url 'product_detail' %}">
            <i class="bi bi-images me-1"></i>
            <span>Product Page</span>
            <div class="nav-underline"></div>
          </a>
        </li>
        <!-- Gallery -->
        <li class="nav-item mx-1">
          <a class="nav-link position-relative px-3 {% if '/gallery/' in request.path %}active{% endif %}" 
             href="{% url 'gallery' %}">
            <i class="bi bi-images me-1"></i>
            <span>Gallery</span>
            <div class="nav-underline"></div>
          </a>
        </li>

        <!-- Contact -->
        <li class="nav-item mx-1">
          <a class="nav-link position-relative px-3 {% if '/contact-us/' in request.path %}active{% endif %}" 
             href="{% url 'contact_us' %}">
            <i class="bi bi-envelope me-1"></i>
            <span>Contact</span>
            <div class="nav-underline"></div>
          </a>
        </li>
      </ul>

      <!-- Right Side Actions -->
      <div class="d-flex align-items-center gap-3">
        <!-- Quick Quote Button -->
        <button class="btn btn-primary-navy btn-sm px-3 py-2 quote-btn" 
                data-bs-toggle="modal" data-bs-target="#quoteModal">
          <i class="bi bi-clipboard-check me-2"></i>
          <span>Get Quote</span>
        </button>

        <!-- User Dropdown -->
        <div class="dropdown">
          <a href="#" class="user-avatar" id="userDropdown" 
             data-bs-toggle="dropdown" aria-expanded="false">
            <div class="avatar-circle">
              <i class="bi bi-person-circle"></i>
            </div>
          </a>
          <ul class="dropdown-menu dropdown-menu-end shadow border-0" 
              aria-labelledby="userDropdown">
            <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#loginModal"><i class="bi bi-person me-2"></i>Login/Register</a></li>
            <li><a class="dropdown-item" href="#"><i class="bi bi-heart me-2"></i>Saved</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="#"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</nav>

<!-- Spacer for fixed navbar -->
<div class="navbar-spacer" style="height: 70px;"></div>

<!-- Enhanced Login/Register Modal -->
<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content border-0 shadow-lg">
      <div class="modal-header border-0 pb-0 pt-4 px-4">
        <div class="w-100 d-flex justify-content-between align-items-center">
          <div>
            <h4 class="modal-title fw-bold text-primary-navy mb-0">Everest Memorial Account</h4>
            <p class="text-muted small mb-0 mt-1" id="collection-message">Login or register to access premium collections</p>
          </div>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
      </div>
      
      <div class="modal-body p-0">
        <div class="container-fluid">
          <div class="row g-0">
            <!-- Left Side - Info with Background Image -->
            <div class="col-lg-6 d-none d-lg-block">
              <div class="info-section h-100 p-5 position-relative overflow-hidden">
                <!-- Background Image with Overlay -->
                <div class="bg-cover position-absolute top-0 start-0 w-100 h-100" 
                     style="background-image: url('{% static 'assets/img/login-bg.jpg' %}');">
                  <div class="position-absolute top-0 start-0 w-100 h-100 bg-primary-navy bg-opacity-85"></div>
                </div>
                
                <!-- Content -->
                <div class="position-relative z-1 h-100 d-flex flex-column">
                  <div class="brand-info mb-5">
                    <div class="text-center mb-4">
                      <div class="logo-circle bg-white bg-opacity-20 backdrop-blur rounded-circle p-3 d-inline-flex mb-3 border border-white border-opacity-25">
                        <i class="bi bi-lock-fill text-white fs-3"></i>
                      </div>
                      <h4 class="fw-bold mb-2 text-white">Secure Access Required</h4>
                      <p class="small text-white text-opacity-90 mb-0">Premium Collections Gateway</p>
                    </div>
                    
                    <div class="alert bg-white bg-opacity-15 border-start border-4 border-warning border-opacity-75 p-3 backdrop-blur">
                      <div class="d-flex">
                        <div class="flex-shrink-0">
                          <i class="bi bi-shield-check text-warning fs-4"></i>
                        </div>
                        <div class="flex-grow-1 ms-3">
                          <p class=" mb-0 fw-medium">
                            <span class="text-warning fw-bold">ðŸ”’ Restricted Access:</span> 
                            Please login or register to view exclusive Tibetan carpet collections.
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <div class="features-section mt-auto">
                    <h5 class="fw-bold mb-3 text-white">Member Benefits:</h5>
                    <div class="row g-2 mb-3">
                      <div class="col-6">
                        <div class="d-flex align-items-center mb-2">
                          <i class="bi bi-collection text-warning me-2 fs-5"></i>
                          <span class="text-white">Premium collections</span>
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="d-flex align-items-center mb-2">
                          <i class="bi bi-heart text-warning me-2 fs-5"></i>
                          <span class="text-white">Save favorites</span>
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="d-flex align-items-center mb-2">
                          <i class="bi bi-cash-coin text-warning me-2 fs-5"></i>
                          <span class="text-white">Custom quotes</span>
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="d-flex align-items-center mb-2">
                          <i class="bi bi-truck text-warning me-2 fs-5"></i>
                          <span class="text-white">Order tracking</span>
                        </div>
                      </div>
                    </div>
                    
                    <div class="mt-4 pt-3 border-top border-white border-opacity-10">
                      <div class="d-flex align-items-center justify-content-center">
                        <i class="bi bi-star-fill text-warning me-2"></i>
                        <small class="text-white text-opacity-75">Trusted by 500+ customers worldwide</small>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Right Side - Forms -->
            <div class="col-lg-6">
              <div class="p-4 p-md-5">
                <!-- Tabs -->
                <div class="auth-tabs mb-4">
                  <div class="d-flex gap-2">
                    <button class="btn btn-primary-navy btn-lg flex-fill active" id="login-tab-btn">
                      <i class="bi bi-box-arrow-in-right me-2"></i>Login
                    </button>
                    <button class="btn btn-outline-primary-navy btn-lg flex-fill" id="register-tab-btn">
                      <i class="bi bi-person-plus me-2"></i>Register
                    </button>
                  </div>
                </div>

                <!-- Forms Container -->
                <div id="forms-container">
                  <!-- Login Form (Initially Visible) -->
                  <form id="loginForm" class="auth-form">
                    <div class="mb-3">
                      <label for="loginEmail" class="form-label fw-medium">Email Address</label>
                      <div class="input-group">
                        <span class="input-group-text bg-light">
                          <i class="bi bi-envelope text-primary-navy"></i>
                        </span>
                        <input type="email" class="form-control form-control-lg" id="loginEmail" placeholder="you@example.com" required>
                      </div>
                    </div>
                    
                    <div class="mb-3">
                      <label for="loginPassword" class="form-label fw-medium">Password</label>
                      <div class="input-group">
                        <span class="input-group-text bg-light">
                          <i class="bi bi-lock text-primary-navy"></i>
                        </span>
                        <input type="password" class="form-control form-control-lg" id="loginPassword" placeholder="Enter your password" required>
                        <button type="button" class="btn btn-outline-secondary toggle-password" data-target="loginPassword">
                          <i class="bi bi-eye"></i>
                        </button>
                      </div>
                    </div>
                    
                    <div class="d-flex justify-content-between align-items-center mb-4">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="rememberMe">
                        <label class="form-check-label" for="rememberMe">Remember me</label>
                      </div>
                      <a href="#" class="text-primary-navy text-decoration-none">Forgot password?</a>
                    </div>
                    
                    <button type="submit" class="btn btn-primary-navy btn-lg w-100 mb-3 py-3">
                      <i class="bi bi-box-arrow-in-right me-2"></i>Login to Account
                    </button>
                    
                    <div class="text-center">
                      <p class="mb-0">
                        Don't have an account? 
                        <a href="#" class="text-primary-navy fw-medium text-decoration-none" id="switch-to-register">Register here</a>
                      </p>
                    </div>
                  </form>

                  <!-- Register Form (Initially Hidden) -->
                  <form id="registerForm" class="auth-form d-none">
                    <div class="row g-3 mb-3">
                      <div class="col-md-6">
                        <label class="form-label fw-medium">First Name</label>
                        <div class="input-group">
                          <span class="input-group-text bg-light">
                            <i class="bi bi-person text-primary-navy"></i>
                          </span>
                          <input type="text" class="form-control" id="firstName" placeholder="John" required>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <label class="form-label fw-medium">Last Name</label>
                        <div class="input-group">
                          <span class="input-group-text bg-light">
                            <i class="bi bi-person text-primary-navy"></i>
                          </span>
                          <input type="text" class="form-control" id="lastName" placeholder="Doe" required>
                        </div>
                      </div>
                    </div>
                    
                    <div class="mb-3">
                      <label class="form-label fw-medium">Email Address</label>
                      <div class="input-group">
                        <span class="input-group-text bg-light">
                          <i class="bi bi-envelope text-primary-navy"></i>
                        </span>
                        <input type="email" class="form-control form-control-lg" id="registerEmail" placeholder="you@example.com" required>
                      </div>
                    </div>
                    
                    <div class="row g-3 mb-3">
                      <div class="col-md-6">
                        <label class="form-label fw-medium">Password</label>
                        <div class="input-group">
                          <span class="input-group-text bg-light">
                            <i class="bi bi-lock text-primary-navy"></i>
                          </span>
                          <input type="password" class="form-control" id="registerPassword" placeholder="Create password" required>
                          <button type="button" class="btn btn-outline-secondary toggle-password" data-target="registerPassword">
                            <i class="bi bi-eye"></i>
                          </button>
                        </div>
                        <div class="form-text">At least 8 characters</div>
                      </div>
                      
                      <div class="col-md-6">
                        <label class="form-label fw-medium">Confirm Password</label>
                        <div class="input-group">
                          <span class="input-group-text bg-light">
                            <i class="bi bi-lock-fill text-primary-navy"></i>
                          </span>
                          <input type="password" class="form-control" id="confirmPassword" placeholder="Confirm password" required>
                          <button type="button" class="btn btn-outline-secondary toggle-password" data-target="confirmPassword">
                            <i class="bi bi-eye"></i>
                          </button>
                        </div>
                      </div>
                    </div>
                    
                    <div class="form-check mb-4">
                      <input class="form-check-input" type="checkbox" id="terms" required>
                      <label class="form-check-label" for="terms">
                        I agree to the <a href="#" class="text-primary-navy text-decoration-none">Terms</a> & 
                        <a href="#" class="text-primary-navy text-decoration-none">Privacy Policy</a>
                      </label>
                    </div>
                    
                    <button type="submit" class="btn btn-primary-navy btn-lg w-100 mb-3 py-3">
                      <i class="bi bi-person-plus me-2"></i>Create Account
                    </button>
                    
                    <div class="text-center">
                      <p class="mb-0">
                        Already have an account? 
                        <a href="#" class="text-primary-navy fw-medium text-decoration-none" id="switch-to-login">Login here</a>
                      </p>
                    </div>
                  </form>
                </div>
                
                <!-- Social Login -->
                <div class="mt-4 pt-4 border-top">
                  <p class="text-center mb-3">Or continue with</p>
                  <div class="row g-2">
                    <div class="col-6">
                      <button type="button" class="btn btn-outline-secondary w-100 d-flex align-items-center justify-content-center py-2">
                        <i class="bi bi-google text-danger me-2 fs-5"></i> Google
                      </button>
                    </div>
                    <div class="col-6">
                      <button type="button" class="btn btn-outline-secondary w-100 d-flex align-items-center justify-content-center py-2">
                        <i class="bi bi-facebook text-primary me-2 fs-5"></i> Facebook
                      </button>
                    </div>
                  </div>
                  
                  <!-- Security Note -->
                  <div class="mt-3 pt-3 border-top text-center">
                    <div class="d-flex align-items-center justify-content-center">
                      <i class="bi bi-shield-check text-success me-2"></i>
                      <small class="text-muted">Your data is secure and encrypted</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Navbar Styles -->
<style>
/* ========== NAVBAR VARIABLES ========== */
:root {
  --primary-navy: #0a192f;
  --dark-navy: #071528;
  --medium-navy: #1e3a5f;
  --light-navy: #2c5282;
  --accent-gold: #d4af37;
  --transition-smooth: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* ========== ENHANCED MODAL STYLES ========== */
.modal-lg {
  max-width: 900px;
}

#loginModal .modal-content {
  border-radius: 20px;
  overflow: hidden;
}

#loginModal .modal-header {
  padding: 1.5rem 2rem 0;
}

#loginModal .modal-body {
  max-height: none;
  overflow: visible;
}

/* Info Section */
.info-section {
  background: linear-gradient(135deg, #0a192f, #1e3a5f);
  min-height: 600px;
}

.bg-cover {
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
}

.logo-circle {
  width: 70px;
  height: 70px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.backdrop-blur {
  backdrop-filter: blur(8px);
}

/* Text Readability Enhancement */
.text-white {
  color: rgba(255, 255, 255, 0.95) !important;
}

.text-opacity-90 {
  opacity: 0.9;
}

/* Form Section */
.auth-form {
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Button Styles */
.btn-primary-navy {
  background: #0a192f;
  border: none;
  color: white;
  font-weight: 500;
  letter-spacing: 0.5px;
  transition: all 0.3s ease;
}

.btn-primary-navy:hover {
  background: #1e3a5f;
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(10, 25, 47, 0.2);
}

.btn-outline-primary-navy {
  color: #0a192f;
  border: 2px solid #0a192f;
  background: transparent;
  font-weight: 500;
  letter-spacing: 0.5px;
  transition: all 0.3s ease;
}

.btn-outline-primary-navy:hover,
.btn-outline-primary-navy.active {
  background: #0a192f;
  color: white;
  transform: translateY(-2px);
}

.btn-lg {
  padding: 0.875rem 1.5rem;
  font-size: 1rem;
}

/* Input Styles */
.form-control, .form-select {
  border: 1px solid rgba(10, 25, 47, 0.15);
  border-radius: 10px;
  padding: 0.75rem 1rem;
  transition: all 0.3s ease;
  font-size: 1rem;
}

.form-control:focus, .form-select:focus {
  border-color: #0a192f;
  box-shadow: 0 0 0 3px rgba(10, 25, 47, 0.1);
  transform: translateY(-1px);
}

.form-control-lg {
  padding: 0.875rem 1.25rem;
  font-size: 1.1rem;
}

.input-group-text {
  background-color: #f8f9fa;
  border-color: rgba(10, 25, 47, 0.15);
  padding: 0.75rem 1rem;
}

/* Label Styles */
.form-label {
  color: #0a192f;
  font-size: 0.95rem;
  margin-bottom: 0.5rem;
  display: block;
}

.form-label.fw-medium {
  font-weight: 500;
}

/* Alert */
.alert.bg-white.bg-opacity-15 {
  backdrop-filter: blur(10px);
  border-radius: 10px;
}

/* Features Grid */
.features-section h5 {
  font-size: 1.1rem;
  margin-bottom: 1rem;
}

.features-section .col-6 {
  margin-bottom: 0.75rem;
}

.features-section i {
  font-size: 1.25rem;
}

/* Social Buttons */
.btn-outline-secondary {
  border: 1px solid #dee2e6;
  color: #495057;
  padding: 0.75rem;
  transition: all 0.3s ease;
}

.btn-outline-secondary:hover {
  border-color: #0a192f;
  color: #0a192f;
  background: rgba(10, 25, 47, 0.02);
}

/* Premium Access Lock Animation */
.premium-access {
  position: relative;
  cursor: pointer;
}

.premium-access::after {
  content: '\F4D1';
  font-family: 'bootstrap-icons';
  position: absolute;
  right: 15px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--primary-navy);
  opacity: 0.5;
  font-size: 0.9rem;
  transition: opacity 0.3s ease;
}

.premium-access:hover::after {
  opacity: 1;
  animation: lockShake 0.5s ease;
}

@keyframes lockShake {
  0%, 100% { transform: translateY(-50%) rotate(0deg); }
  25% { transform: translateY(-50%) rotate(-10deg); }
  75% { transform: translateY(-50%) rotate(10deg); }
}

/* Responsive */
@media (max-width: 991.98px) {
  .modal-lg {
    max-width: 95%;
    margin: 0.5rem auto;
  }
  
  .info-section {
    display: none;
  }
  
  .col-lg-6 {
    width: 100%;
  }
  
  #loginModal .modal-body {
    padding: 1rem;
  }
}

@media (max-width: 576px) {
  .modal-lg {
    margin: 0.25rem;
  }
  
  .p-4, .p-md-5 {
    padding: 1.5rem !important;
  }
  
  .btn-lg {
    padding: 0.75rem 1rem;
    font-size: 0.95rem;
  }
  
  .form-control-lg {
    padding: 0.75rem 1rem;
    font-size: 1rem;
  }
}

/* ========== MAIN NAVBAR STYLES (UNCHANGED) ========== */
#mainNavbar {
  padding: 0.5rem 0;
  background: rgba(255, 255, 255, 0.98) !important;
  backdrop-filter: blur(10px);
  border-bottom: 1px solid rgba(10, 25, 47, 0.1);
  transition: all var(--transition-smooth);
  z-index: 1030;
}

#mainNavbar.scrolled {
  box-shadow: 0 4px 20px rgba(10, 25, 47, 0.08);
  padding: 0.3rem 0;
}

.brand-container {
  transition: transform var(--transition-smooth);
}

.brand-container:hover {
  transform: translateY(-1px);
}

.brand-logo {
  height: 45px;
  width: auto;
  transition: all var(--transition-smooth);
  filter: drop-shadow(0 2px 4px rgba(10, 25, 47, 0.1));
}

.logo-glow {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 50px;
  height: 50px;
  background: radial-gradient(circle, var(--primary-navy) 0%, transparent 70%);
  opacity: 0;
  transition: opacity var(--transition-smooth);
  pointer-events: none;
}

.brand-container:hover .logo-glow {
  opacity: 0.1;
}

.brand-name {
  font-size: 1.1rem;
  letter-spacing: 0.5px;
  line-height: 1.2;
}

.brand-subtitle {
  font-size: 0.75rem;
  letter-spacing: 1px;
  text-transform: uppercase;
}

.nav-link {
  color: var(--primary-navy) !important;
  font-weight: 500;
  font-size: 0.9rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  padding: 0.5rem 1rem !important;
  border-radius: 6px;
  transition: all var(--transition-smooth);
  position: relative;
}

.nav-link:hover {
  color: var(--light-navy) !important;
  background: rgba(10, 25, 47, 0.03);
  transform: translateY(-1px);
}

.nav-link.active {
  color: var(--primary-navy) !important;
  font-weight: 600;
}

.nav-underline {
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%) scaleX(0);
  width: 0;
  height: 2px;
  background: linear-gradient(90deg, var(--accent-gold), var(--light-navy));
  transition: all var(--transition-smooth);
  border-radius: 2px;
}

.nav-link:hover .nav-underline,
.nav-link.active .nav-underline {
  width: 70%;
  transform: translateX(-50%) scaleX(1);
}

.dropdown-menu {
  border: none !important;
  border-radius: 12px !important;
  padding: 0.5rem !important;
  box-shadow: 0 10px 40px rgba(10, 25, 47, 0.1) !important;
  margin-top: 10px !important;
  animation: dropdownFadeIn 0.2s ease-out !important;
  overflow: visible !important;
  max-width: 100vw;
}

@keyframes dropdownFadeIn {
  from {
    opacity: 0;
    transform: translateY(-5px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.dropdown-menu-start {
  left: 0 !important;
  right: auto !important;
}

@media (max-width: 992px) {
  .dropdown-menu {
    position: static !important;
    float: none !important;
    width: 100% !important;
    margin: 0.5rem 0 !important;
    box-shadow: none !important;
    border: 1px solid rgba(0,0,0,0.1) !important;
  }
}

.dropdown-item {
  border-radius: 8px;
  padding: 0.75rem 1rem !important;
  transition: all var(--transition-smooth);
  margin: 2px 0;
  position: relative;
  overflow: hidden;
}

.dropdown-item::before {
  content: '';
  position: absolute;
  left: -100%;
  top: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(10, 25, 47, 0.05), transparent);
  transition: left 0.6s ease;
}

.dropdown-item:hover::before {
  left: 100%;
}

.dropdown-item:hover {
  background: rgba(10, 25, 47, 0.03) !important;
  color: var(--primary-navy) !important;
  transform: translateX(3px);
}

.dropdown-icon {
  width: 36px;
  height: 36px;
  background: rgba(10, 25, 47, 0.05);
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.1rem;
  transition: all var(--transition-smooth);
}

.dropdown-item:hover .dropdown-icon {
  background: var(--primary-navy);
  color: white !important;
  transform: rotate(5deg);
}

.quality-badge {
  width: 36px;
  height: 36px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 0.9rem;
  color: white;
  flex-shrink: 0;
  transition: all var(--transition-smooth);
}

.quality-all {
  background: linear-gradient(135deg, #667eea, #764ba2);
}

.quality-60 {
  background: linear-gradient(135deg, #4ade80, #22c55e);
}

.quality-80 {
  background: linear-gradient(135deg, #3b82f6, #2563eb);
}

.quality-100 {
  background: linear-gradient(135deg, #8b5cf6, #7c3aed);
}

.dropdown-item:hover .quality-badge {
  transform: scale(1.1) rotate(5deg);
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.btn-primary-navy {
  background: var(--primary-navy);
  border: none;
  color: white;
  border-radius: 25px;
  font-weight: 500;
  letter-spacing: 0.5px;
  transition: all var(--transition-smooth);
  position: relative;
  overflow: hidden;
}

.btn-primary-navy:hover {
  background: var(--medium-navy);
  color: white;
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(10, 25, 47, 0.2);
}

.btn-primary-navy::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.3);
  transform: translate(-50%, -50%);
  transition: width 0.6s, height 0.6s;
}

.btn-primary-navy:active::after {
  width: 200px;
  height: 200px;
}

.user-avatar {
  text-decoration: none;
}

.avatar-circle {
  width: 40px;
  height: 40px;
  background: rgba(10, 25, 47, 0.05);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.3rem;
  color: var(--primary-navy);
  transition: all var(--transition-smooth);
}

.user-avatar:hover .avatar-circle {
  background: var(--primary-navy);
  color: white;
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(10, 25, 47, 0.2);
}

@media (max-width: 992px) {
  #navbarContent {
    background: white;
    border-radius: 0 0 15px 15px;
    padding: 1rem;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    margin-top: 0.5rem;
  }
  
  .navbar-nav {
    margin-bottom: 1rem;
  }
  
  .nav-item {
    margin: 0.25rem 0;
  }
  
  .nav-link {
    padding: 0.75rem 1rem !important;
    border-radius: 8px;
  }
  
  .d-flex.align-items-center.gap-3 {
    flex-direction: column;
    gap: 1rem !important;
    width: 100%;
  }
  
  .quote-btn {
    width: 100%;
    justify-content: center;
  }
  
  .user-avatar {
    align-self: center;
  }
}

.navbar-toggler {
  border: none !important;
  padding: 0.25rem;
  transition: all var(--transition-smooth);
}

.navbar-toggler:focus {
  box-shadow: 0 0 0 2px rgba(10, 25, 47, 0.1) !important;
}

.navbar-toggler-icon {
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba(10, 25, 47, 0.8)' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e") !important;
}

@keyframes fadeInDown {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

#mainNavbar {
  animation: fadeInDown 0.5s ease-out;
}


/* Fix dropdown alignment issues */
.dropdown-item .d-flex {
  position: relative;
  width: 100%;
}

.dropdown-item .flex-grow-1 {
  flex: 1;
  min-width: 0; /* Prevent text overflow */
}

.dropdown-item .badge {
  flex-shrink: 0;
  white-space: nowrap;
  margin-left: 0.5rem !important;
}

/* Fix for premium access items to ensure proper spacing */
.premium-access .d-flex {
  padding-right: 1.5rem; /* Make room for lock icon */
}

/* Adjust lock icon positioning to not interfere with layout */
.premium-access::after {
  content: '\F4D1';
  font-family: 'bootstrap-icons';
  position: absolute;
  right: 1rem; /* Fixed position from right */
  top: 50%;
  transform: translateY(-50%);
  color: var(--primary-navy);
  opacity: 0.5;
  font-size: 0.9rem;
  transition: opacity 0.3s ease;
  pointer-events: none; /* Don't interfere with clicking */
}

.premium-access:hover::after {
  opacity: 1;
  animation: lockShake 0.5s ease;
}

</style>

<!-- Enhanced JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const navbar = document.getElementById('mainNavbar');
  
  // Scroll effect
  window.addEventListener('scroll', function() {
    if (window.scrollY > 10) {
      navbar.classList.add('scrolled');
    } else {
      navbar.classList.remove('scrolled');
    }
  });
  
  // Close dropdowns when clicking outside
  document.addEventListener('click', function(event) {
    if (!event.target.closest('.dropdown') && !event.target.closest('.dropdown-menu')) {
      document.querySelectorAll('.dropdown-menu.show').forEach(menu => {
        menu.classList.remove('show');
      });
    }
  });
  
  // Smooth hover for dropdowns
  const dropdowns = document.querySelectorAll('.dropdown');
  dropdowns.forEach(dropdown => {
    dropdown.addEventListener('mouseenter', function() {
      if (window.innerWidth > 992) {
        const menu = this.querySelector('.dropdown-menu');
        if (menu) {
          menu.classList.add('show');
          this.querySelector('.dropdown-toggle').setAttribute('aria-expanded', 'true');
        }
      }
    });
    
    dropdown.addEventListener('mouseleave', function() {
      if (window.innerWidth > 992) {
        const menu = this.querySelector('.dropdown-menu');
        if (menu) {
          setTimeout(() => {
            if (!this.matches(':hover')) {
              menu.classList.remove('show');
              this.querySelector('.dropdown-toggle').setAttribute('aria-expanded', 'false');
            }
          }, 200);
        }
      }
    });
  });
  
  // Mobile menu animation
  const navbarToggler = document.querySelector('.navbar-toggler');
  if (navbarToggler) {
    navbarToggler.addEventListener('click', function() {
      const icon = this.querySelector('.navbar-toggler-icon');
      if (this.getAttribute('aria-expanded') === 'true') {
        icon.style.transform = 'rotate(180deg)';
      } else {
        icon.style.transform = 'rotate(0deg)';
      }
    });
  }
  
  // Nav link click animation
  const navLinks = document.querySelectorAll('.nav-link');
  navLinks.forEach(link => {
    link.addEventListener('click', function(e) {
      if (this.getAttribute('href') !== '#') {
        this.style.transform = 'scale(0.95)';
        setTimeout(() => {
          this.style.transform = '';
        }, 150);
      }
    });
  });
  
  // Initialize scroll position
  if (window.scrollY > 10) {
    navbar.classList.add('scrolled');
  }
  
  // Modal functionality
  const modal = document.getElementById('loginModal');
  const loginTabBtn = document.getElementById('login-tab-btn');
  const registerTabBtn = document.getElementById('register-tab-btn');
  const loginForm = document.getElementById('loginForm');
  const registerForm = document.getElementById('registerForm');
  const switchToRegister = document.getElementById('switch-to-register');
  const switchToLogin = document.getElementById('switch-to-login');
  const collectionMessage = document.getElementById('collection-message');
  
  // Tab switching
  function showLoginForm() {
    loginTabBtn.classList.add('btn-primary-navy', 'active');
    loginTabBtn.classList.remove('btn-outline-primary-navy');
    registerTabBtn.classList.add('btn-outline-primary-navy');
    registerTabBtn.classList.remove('btn-primary-navy', 'active');
    loginForm.classList.remove('d-none');
    registerForm.classList.add('d-none');
  }
  
  function showRegisterForm() {
    registerTabBtn.classList.add('btn-primary-navy', 'active');
    registerTabBtn.classList.remove('btn-outline-primary-navy');
    loginTabBtn.classList.add('btn-outline-primary-navy');
    loginTabBtn.classList.remove('btn-primary-navy', 'active');
    registerForm.classList.remove('d-none');
    loginForm.classList.add('d-none');
  }
  
  // Event listeners for tab buttons
  if (loginTabBtn) loginTabBtn.addEventListener('click', showLoginForm);
  if (registerTabBtn) registerTabBtn.addEventListener('click', showRegisterForm);
  
  // Event listeners for switch links
  if (switchToRegister) {
    switchToRegister.addEventListener('click', function(e) {
      e.preventDefault();
      showRegisterForm();
    });
  }
  
  if (switchToLogin) {
    switchToLogin.addEventListener('click', function(e) {
      e.preventDefault();
      showLoginForm();
    });
  }
  
  // Password visibility toggle
  document.querySelectorAll('.toggle-password').forEach(button => {
    button.addEventListener('click', function() {
      const targetId = this.getAttribute('data-target');
      const passwordInput = document.getElementById(targetId);
      
      if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        this.innerHTML = '<i class="bi bi-eye-slash"></i>';
      } else {
        passwordInput.type = 'password';
        this.innerHTML = '<i class="bi bi-eye"></i>';
      }
    });
  });
  
  // Premium collection click handlers
  const premiumLinks = document.querySelectorAll('.premium-access');
  
  premiumLinks.forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      const selectedCollection = this.getAttribute('data-collection');
      
      if (collectionMessage) {
        if (selectedCollection === '80') {
          collectionMessage.textContent = 'Login to access the Premium 80 Knots Collection with exclusive designs.';
        } else if (selectedCollection === '100') {
          collectionMessage.textContent = 'Login to access the Exclusive 100 Knots VIP Collection with heirloom-quality carpets.';
        }
      }
      
      if (selectedCollection) {
        sessionStorage.setItem('targetCollection', selectedCollection);
      }
    });
  });
  
  // Form submission handlers
  if (loginForm) {
    loginForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      
      if (email && password) {
        showAlert('success', 'Login successful!');
        
        setTimeout(() => {
          const modalInstance = bootstrap.Modal.getInstance(modal);
          if (modalInstance) modalInstance.hide();
          
          const targetCollection = sessionStorage.getItem('targetCollection');
          if (targetCollection) {
            window.location.href = `{% url 'products' %}?quality=${targetCollection}`;
            sessionStorage.removeItem('targetCollection');
          }
        }, 1500);
      } else {
        showAlert('error', 'Please fill in all required fields.');
      }
    });
  }
  
  if (registerForm) {
    registerForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const firstName = document.getElementById('firstName').value;
      const lastName = document.getElementById('lastName').value;
      const email = document.getElementById('registerEmail').value;
      const password = document.getElementById('registerPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      
      if (!firstName || !lastName || !email || !password || !confirmPassword) {
        showAlert('error', 'Please fill in all required fields.');
        return;
      }
      
      if (password !== confirmPassword) {
        showAlert('error', 'Passwords do not match.');
        return;
      }
      
      showAlert('success', 'Registration successful! Welcome to Everest Memorial.');
      
      setTimeout(() => {
        showLoginForm();
      }, 1500);
    });
  }
  
  // Helper function to show alerts
  function showAlert(type, message) {
    const existingAlert = document.querySelector('.auth-alert');
    if (existingAlert) existingAlert.remove();
    
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type === 'success' ? 'success' : 'danger'} auth-alert alert-dismissible fade show`;
    alertDiv.innerHTML = `
      <div class="d-flex align-items-center">
        <i class="bi ${type === 'success' ? 'bi-check-circle' : 'bi-exclamation-circle'} me-2"></i>
        <span>${message}</span>
      </div>
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    const formsContainer = document.getElementById('forms-container');
    if (formsContainer) {
      formsContainer.insertBefore(alertDiv, formsContainer.firstChild);
    }
    
    setTimeout(() => {
      if (alertDiv.parentNode) alertDiv.remove();
    }, 5000);
  }
  
  // Reset forms when modal is closed
  if (modal) {
    modal.addEventListener('hidden.bs.modal', function() {
      showLoginForm();
      if (loginForm) loginForm.reset();
      if (registerForm) registerForm.reset();
      if (collectionMessage) {
        collectionMessage.textContent = 'Login or register to access premium collections';
      }
      
      const existingAlert = document.querySelector('.auth-alert');
      if (existingAlert) existingAlert.remove();
    });
  }
  
  // Check if user is logged in
  const isLoggedIn = false;
  
  if (isLoggedIn) {
    document.querySelectorAll('.premium-access').forEach(link => {
      const collection = link.getAttribute('data-collection');
      link.href = `{% url 'products' %}?quality=${collection}`;
      link.removeAttribute('data-bs-toggle');
      link.removeAttribute('data-bs-target');
    });
  }
});
</script>